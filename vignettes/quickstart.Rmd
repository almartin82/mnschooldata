---
title: "Getting Started with mnschooldata"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started with mnschooldata}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, eval = TRUE, include=FALSE}
knitr::opts_chunk$set(
  echo = TRUE,
  message = FALSE,
  warning = FALSE,
  fig.width = 7,
  fig.height = 4,
  cache = TRUE
)
```

## Installation

Install from GitHub:

```r
# install.packages("remotes")
remotes::install_github("almartin82/mnschooldata")
```

## Quick Example

Fetch Minnesota enrollment data:

```{r fetch-data, eval = FALSE}
library(mnschooldata)
library(dplyr)

# Fetch 2023 enrollment data
enr <- fetch_enr(2023, use_cache = TRUE)

head(enr)
```

```{r load-cached-data, eval = TRUE}
# For vignette building, use bundled example data
library(mnschooldata)
library(dplyr)

data("enr_2023_example", package = "mnschooldata")
enr <- enr_2023_example
head(enr)
```

## Understanding the Data

The data is returned in **tidy (long) format** by default:

- Each row is one subgroup for one school/district/state
- `subgroup` identifies the demographic group (e.g., "total_enrollment", "white", "black", "hispanic")
- `grade_level` shows the grade ("TOTAL", "K", "01", "02", etc.)
- `n_students` is the enrollment count
- `pct` is the percentage of total enrollment

```{r data-structure}
enr %>%
  filter(is_state) %>%
  select(end_year, type, subgroup, grade_level, n_students) %>%
  head(10)
```

## Filtering by Level

Use the aggregation flags to filter data:

```{r filter-levels}
# State totals
state <- enr %>% filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL")
state %>% select(end_year, n_students)

# All districts
districts <- enr %>% filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL")
cat("Number of districts:", nrow(districts), "\n")
```

## Simple Analysis: Top 10 Districts

```{r top-districts}
enr %>%
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") %>%
  arrange(desc(n_students)) %>%
  select(district_name, n_students) %>%
  head(10)
```

## Demographic Analysis

```{r demographics}
# State demographics
enr %>%
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("white", "black", "hispanic", "asian", "multiracial", "native_american")) %>%
  select(subgroup, n_students, pct) %>%
  mutate(pct = round(pct * 100, 1))
```

## Wide Format

If you prefer wide format (one column per demographic), set `tidy = FALSE`:

```{r wide-format, eval = FALSE}
enr_wide <- fetch_enr(2023, tidy = FALSE, use_cache = TRUE)

enr_wide %>%
  filter(type == "State") %>%
  select(end_year, row_total, white, black, hispanic, asian)
```

## Minnesota-Specific Features

Minnesota has several unique district types:

```{r district-types}
enr %>%
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") %>%
  mutate(district_type_label = case_when(
    district_type == "01" ~ "Independent School District",
    district_type == "03" ~ "Special School District",
    district_type == "07" ~ "Charter School",
    TRUE ~ "Other"
  )) %>%
  count(district_type_label) %>%
  arrange(desc(n))
```

## Next Steps

- See `vignette("enrollment_hooks")` for 15 stories from Minnesota enrollment data
- Use `?fetch_enr` for full function documentation

## Session Info

```{r session-info}
sessionInfo()
```
